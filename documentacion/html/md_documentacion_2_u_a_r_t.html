<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>multiherramienta: UART</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">multiherramienta
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_documentacion_2_u_a_r_t.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">UART</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Que es y como funciona</h1>
<p>[WIP] Explicacion y base teorica sobre UART</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Impliementación en PIC18F45K50</h1>
<p>El PIC seleccionado cuenta con un modulo EUSART (Enhanced Universal Synchronous Asynchronous Receiver Transmitter) por lo que se podra trabajar en modo asincrono o sincrono.</p>
<p>La operacion del modulo EUSART es controlada por 3 registros <br  />
</p>
<ul>
<li>Transmit Status and Control (TXSTAx)</li>
<li>Receive Status and Control (RCSTAx)</li>
<li>Baud Rate Control (BAUDCONx) <br  />
</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md4"></a>
Configuracion de transmision Asincrona</h2>
<p>Segun el propio datasheet. Estos son los pasos para realizar una transmision asincrona:</p>
<blockquote class="doxtable">
<p>&zwj;1. Inicialice el par de registros SPBRGHx:SPBRGx y los bits BRGH y BRG16 para lograr la tasa de baudios deseada.</p><ol type="1">
<li>Establezca los controles TRIS RX/DT y TX/CK en '1'.</li>
<li>Habilite el puerto serie asíncrono borrando el bit SYNC y configurando el bit SPEN.</li>
<li>Si se desea una transmisión de 9 bits, establezca el bit de control TX9. Un noveno bit de datos establecido indicará que los ocho bits de datos menos significativos son una dirección cuando el receptor esté configurado para la detección de direcciones.</li>
<li>Establezca el bit de control TXCKP si se desea una polaridad de datos de transmisión invertida.</li>
<li>Habilite la transmisión configurando el bit de control TXEN. Esto hará que se active el bit de interrupción TXIF.</li>
<li>Si se desean interrupciones, establezca el bit de habilitación de interrupción TXIE. Se producirá una interrupción de inmediato siempre que los bits GIE/GIEH y PEIE/GIEL del registro INTCON también estén configurados.</li>
<li>Si se selecciona la transmisión de 9 bits, el noveno bit debe ser cargado en el bit de datos TX9D.</li>
<li>Cargue datos de 8 bits en el registro TXREGx. Esto iniciará la transmisión. <br  />
 </li>
</ol>
</blockquote>
<h3><a class="anchor" id="autotoc_md5"></a>
1 - Configurar los baudios</h3>
<p>Los registros que se usaran son:</p>
<ul>
<li>TXSTA1: <br  />
<ul>
<li>SYNC: Selecciona el modo del EUSART <br  />
 1 = Sincrono <br  />
 <em><b>0 = Asincrono</b></em> <br  />
<ul>
<li>Por ahora solo lo haremos asincrono</li>
</ul>
</li>
<li>BRGH: Selecciona si sera un rango alto de baudios. Solo con asincrono <br  />
 <em><b>1 = High speed</b></em> <br  />
 0 = Low speed <br  />
<ul>
<li>Se selecciona alta velocidad para mejorar el funcionamiento con el reloj de 48MHz <br  />
</li>
</ul>
</li>
</ul>
</li>
<li>BAUDCON1:<ul>
<li>BRG16: Selecciona si el generador de baudrate usara 8 o 16 bits <br  />
 <em><b>1 = 16-bit Baud Rate Generator is used (SPBRGHx:SPBRGx)</b></em> <br  />
 0 = 8-bit Baud Rate Generator is used (SPBRGx)<ul>
<li>Se seleccionaran 16bits para disminuir el error <br  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Con esta configuracion podemos configurar los baudios entre los mas utilizados cambiando el valor de SPBRGHx:SPBRGx segun la siguiente tabla</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">BR esperado   </th><th class="markdownTableHeadNone">BR Real   </th><th class="markdownTableHeadNone">% Error   </th><th class="markdownTableHeadNone">SPBRGHx:SPBRGx    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">300   </td><td class="markdownTableBodyNone">300   </td><td class="markdownTableBodyNone">0.00   </td><td class="markdownTableBodyNone">39999    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1200   </td><td class="markdownTableBodyNone">1200   </td><td class="markdownTableBodyNone">0.00   </td><td class="markdownTableBodyNone">9999    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2400   </td><td class="markdownTableBodyNone">2400   </td><td class="markdownTableBodyNone">0.00   </td><td class="markdownTableBodyNone">4999    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9600   </td><td class="markdownTableBodyNone">9600   </td><td class="markdownTableBodyNone">0.00   </td><td class="markdownTableBodyNone">1249    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">10417   </td><td class="markdownTableBodyNone">10417   </td><td class="markdownTableBodyNone">0.00   </td><td class="markdownTableBodyNone">1151    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">19.2k   </td><td class="markdownTableBodyNone">19.2k   </td><td class="markdownTableBodyNone">0.00   </td><td class="markdownTableBodyNone">624    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">57.6k   </td><td class="markdownTableBodyNone">57.69k   </td><td class="markdownTableBodyNone">0.16   </td><td class="markdownTableBodyNone">207    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">115.2k   </td><td class="markdownTableBodyNone">115.39k   </td><td class="markdownTableBodyNone">0.16   </td><td class="markdownTableBodyNone">103   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md6"></a>
2 - Configurar pines como tri-estado</h3>
<p>Simplemente se aplican a los correspondientes registros TRIS un 1 <br  />
</p>
<ul>
<li>TRISC: <br  />
<ul>
<li>R6: PORTC Tri-State Control bit <br  />
 <em><b>1 = PORTx pin configured as an input (tri-stated)</b></em> <br  />
 0 = PORTx pin configured as an output<ul>
<li>Se coloca como tri estado para el pin Tx</li>
</ul>
</li>
<li>R7: PORTC Tri-State Control bit <br  />
 <em><b>1 = PORTx pin configured as an input (tri-stated)</b></em> <br  />
 0 = PORTx pin configured as an output<ul>
<li>Se coloca como tri estado para el pin Rx</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md7"></a>
3 - Habilitacion del puerto serie</h3>
<p>El registro SYNC ya fue ajustado en el paso 1. <br  />
</p>
<ul>
<li>RCSTA: <br  />
<ul>
<li>SPEN: Bit de habilitacion de puerto serial <br  />
 <em><b>1 = Puesto serial es habilitado</b></em> <br  />
 0 = Puesto serial es deshabilitado<ul>
<li>Los pines RX/DT y TX/CK seran usados como pines seriales <br  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md8"></a>
4 - 9bits</h3>
<p>Estas funcion si bien podemos agregarla en un futuro. Por el momento no sera inplementada.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
5 - Inversion de polaridad</h3>
<p>No implementada <br  />
</p>
<h3><a class="anchor" id="autotoc_md10"></a>
6 - Habilitar transmision</h3>
<ul>
<li>TXSTA: <br  />
<ul>
<li>TXEN: Bit de habilitacion transmision <br  />
 <em><b>1 = Transmision habilitada</b></em> <br  />
 0 = Transmision deshabilitada</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md11"></a>
7 - Interrupcciones</h3>
<p>No implementado</p>
<h3><a class="anchor" id="autotoc_md12"></a>
8 - Carga bit 9</h3>
<p>No implementado</p>
<h3><a class="anchor" id="autotoc_md13"></a>
9 - Carga de dato</h3>
<p>Aqui solante se trata de cargar el dato a TXREG1 que lo pasara paralelamente a TSR (Transmit Shift Register). El cual pasara los datos hacia el pin de forma serial. <br  />
 Si bien no esta especificado en las instrucciones anteriores se agregara una pequeña funcion con el registro TRMT. Este estara en 0 mientras aun haya datos pendientes en TSR.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Configuración de Recepción Asincrónica</h2>
<p>Segun el propio datasheet. Estos son los pasos para realizar una recepcion asincrona:</p>
<blockquote class="doxtable">
<p>&zwj;1. Inicialice el par de registros SPBRGHx:SPBRGx y los bits BRGH y BRG16 para lograr la tasa de baudios deseada.</p><ol type="1">
<li>Establezca los controles TRIS de RX/DT y TX/CK en '1'.</li>
<li>Habilite el puerto serie configurando el bit SPEN y el bit TRIS del pin RX/DT. El bit SYNC debe estar en cero para el funcionamiento asíncrono.</li>
<li>Si se desean interrupciones, configure el bit de habilitación de interrupciones RCIE y ajuste los bits GIE/GIEH y PEIE/GIEL del registro INTCON.</li>
<li>Si se desea recepción de 9 bits, configure el bit RX9.</li>
<li>Establezca el RXDTP si se desea polaridad de recepción invertida.</li>
<li>Habilite la recepción configurando el bit CREN.</li>
<li>El bit de bandera de interrupción RCIF se establecerá cuando un carácter se transfiera del RSR al búfer de recepción. Se generará una interrupción si también se ha activado el bit de habilitación de interrupción RCIE.</li>
<li>Lea el registro RCSTAx para obtener las banderas de error y, si la recepción de datos de 9 bits está habilitada, el noveno bit de datos.</li>
<li>Obtenga los ocho bits de datos menos significativos recibidos del búfer de recepción leyendo el registro RCREGx.</li>
<li>Si ocurrió un desbordamiento, borre la bandera OERR desactivando el bit de habilitación del receptor CREN. <br  />
 </li>
</ol>
</blockquote>
<p>Como se ve, hasta el paso 6 es lo mismo para la transmision, asi que lo obviaremos.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
7 - Habilitar recepcion</h3>
<ul>
<li>RCSTA: <br  />
<ul>
<li>CREN: Bit de habilitacion recepcion continua <br  />
 <em><b>1 = Recepcion habilitada</b></em> <br  />
 0 = Recepcion deshabilitada <br  />
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md16"></a>
8 - Revisar bandera</h3>
<ul>
<li>PIR1: <br  />
<ul>
<li>RCIF: EUSART Receive Interrupt Flag bit <br  />
 1 = The EUSART receive buffer, RCREG1, is full (cleared when RCREG1 is read) <br  />
 0 = The EUSART receive buffer is empty bit 4 TXIF: EUSART Transmit Interrupt Flag bit</li>
</ul>
</li>
</ul>
<p>Se va a leer el registro, cuando este tenga 1 significa que hay un dato esperando a ser leido.</p>
<h3><a class="anchor" id="autotoc_md17"></a>
9 - Leer errores</h3>
<ul>
<li>RCSTA: <br  />
<ul>
<li>FERR: Framing Error bit <br  />
 1 = Framing error (can be updated by reading RCREGx register and receive next valid byte) <br  />
 0 = No framing error<ul>
<li>Este error es ocacionado cuando no se detecta correctamente el bit de parada, lo que significa un descordinamiento.</li>
</ul>
</li>
<li>OERR: Overrun Error bit <br  />
 1 = Overrun error (can be cleared by clearing bit CREN) <br  />
 0 = No overrun error<ul>
<li>Este error es ocacionado cuando se llena el buffer de datos y no se leyeron antes de llegar mas</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md18"></a>
10 - Leer dato</h3>
<p>Para obtener el dato siemplemente hay que leer el registro RCREG1</p>
<h3><a class="anchor" id="autotoc_md19"></a>
11 - Borrar error de desbordamiento</h3>
<p>Para borrar el registro de OERR hay que dehabilitar y volver a habilitar CREN </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
